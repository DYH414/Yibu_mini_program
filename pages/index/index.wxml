<!-- index.wxml -->
<view class="container">
  <!-- 刷新状态指示器 -->
  <view class="refresh-indicator" wx:if="{{isRefreshing}}">
    <view class="refresh-loading"></view>
    <text class="refresh-text">正在刷新...</text>
  </view>

  <!-- 分类导航 -->
  <scroll-view class="category-scroll" scroll-x enable-flex scroll-with-animation>
    <view class="category-list">
      <view 
        class="category-item {{currentCategory === item.id ? 'active' : ''}}" 
        wx:for="{{categories}}" 
        wx:key="id"
        bindtap="switchCategory"
        data-id="{{item.id}}"
        hover-class="category-item-hover">
        <image class="category-icon" src="{{item.icon}}" mode="aspectFill"></image>
        <text class="category-name">{{item.name}}</text>
      </view>
    </view>
  </scroll-view>

  <!-- 排序选项 -->
  <view class="sort-bar">
    <view class="sort-item {{sortBy === 'default' ? 'active' : ''}}" bindtap="switchSort" data-sort="default" hover-class="sort-item-hover">
      <text>默认排序</text>
    </view>
    <view class="sort-item {{sortBy === 'rating' ? 'active' : ''}}" bindtap="switchSort" data-sort="rating" hover-class="sort-item-hover">
      <text>按评分</text>
    </view>
  </view>

  <!-- 商家列表 -->
  <view class="merchant-list">
    <block wx:if="{{!loading && merchants.length > 0}}">
      <view 
        class="merchant-card" 
        wx:for="{{merchants}}" 
        wx:key="_id"
        bindtap="goToMerchantDetail"
        data-id="{{item._id}}"
        hover-class="merchant-card-hover">
        <view class="merchant-logo">
          <image src="{{item.logoUrl}}" mode="aspectFill"></image>
        </view>
        <view class="merchant-info">
          <view class="merchant-name ellipsis">{{item.name}}</view>
          <view class="merchant-rating">
            <view class="rate">
              <block wx:for="{{item.starArray}}" wx:key="index" wx:for-item="starType">
                <image 
                  class="rate-star" 
                  src="/images/stars/star-{{starType}}.png">
                </image>
              </block>
              <text class="rating-text">{{item.avgRating}} ({{item.ratingCount}})</text>
            </view>
          </view>
          <view class="merchant-desc ellipsis-2">{{item.description}}</view>
        </view>
      </view>
    </block>

    <!-- 空状态 -->
    <view wx:if="{{!loading && merchants.length === 0}}" class="empty-state">
      <text>暂无相关商家</text>
    </view>

    <!-- 加载状态 -->
    <view wx:if="{{loading && !isRefreshing}}" class="loading-state">
      <text>加载中...</text>
    </view>
  </view>
</view> 